{% extends "pages/base.html" %}
{% block title %}Detalle de Vacante{% endblock %}
{% block content %}
<div class="container py-4">
    <a href="{% url 'reclutador' %}" class="btn btn-secondary mb-3">Volver</a>
    <h2 class="mb-3">{{ vacante.titulo }}</h2>
    <div class="card mb-4">
        <div class="card-body">
            <p><strong>Nombre interno:</strong> {{ vacante.nombre_interno|default:"(Sin nombre interno)" }}</p>
            <p><strong>Descripción:</strong> {{ vacante.descripcion }}</p>
            <p><strong>Palabras clave:</strong> {{ vacante.palabras_clave|default:"(predeterminadas: trabajo en equipo, comunicación, responsabilidad, proactividad)" }}</p>
            <p><strong>Rango salarial:</strong> {{ vacante.rango_salarial }}</p>
            <p><strong>Fecha de publicación:</strong> {{ vacante.fecha_creacion|date:"d/m/Y H:i" }}</p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Top 5 candidatos según IA</h5>
        </div>
        <div class="card-body">
            {% if top_candidatos %}
                <ul class="list-group">
                {% for post in top_candidatos %}
                    <li class="list-group-item">
                        <strong>{{ post.postulante.username }}</strong>
                        <span class="badge bg-success ms-2">{{ post.score_ia|default:"N/A" }}%</span>
                        <br>
                        <span class="text-muted">Postulado: {{ post.fecha_postulacion|date:"d/m/Y H:i" }}</span>
                        <br>
                        <strong>IA dice:</strong> {{ post.resumen_ia|default:"-" }}
                        <br>
                        <a href="{{ post.cv_pdf.url }}" target="_blank">Ver CV</a>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No hay análisis IA aún.</p>
            {% endif %}
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Postulaciones recientes</h5>
        </div>
        <div class="card-body">
            {% if recientes %}
                <ul class="list-group">
                {% for post in recientes %}
                    <li class="list-group-item">
                        <strong>{{ post.postulante.username }}</strong>
                        <span class="text-muted">- {{ post.fecha_postulacion|date:"d/m/Y H:i" }}</span>
                        <span class="ms-2">Score IA: <b>{{ post.score_ia|default:"-" }}</b></span>
                        <a href="{{ post.cv_pdf.url }}" class="ms-2" target="_blank">Ver CV</a>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No hay postulaciones recientes.</p>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Todos los candidatos</h5>
        </div>
        <div class="card-body">
            {% if todos %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Candidato</th>
                            <th>Score IA</th>
                            <th>Resumen IA</th>
                            <th>Fecha postulación</th>
                            <th>CV</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for post in todos %}
                        <tr>
                            <td>{{ post.postulante.username }}</td>
                            <td>{{ post.score_ia|default:"-" }}</td>
                            <td>{{ post.resumen_ia|default:"-" }}</td>
                            <td>{{ post.fecha_postulacion|date:"d/m/Y H:i" }}</td>
                            <td><a href="{{ post.cv_pdf.url }}" target="_blank">Ver CV</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-muted">No hay candidatos aún.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}